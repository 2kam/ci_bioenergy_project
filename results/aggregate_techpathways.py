"""Aggregate technology pathway CSV outputs into combined files.

This script searches for individual scenario outputs generated by the
cost analysis pipeline. Files named ``techpathways_<scenario>.csv`` and
``techpathways_summary_<scenario>.csv`` are concatenated into
``techpathways_all.csv`` and ``techpathways_summary_all.csv``
respectively. A new ``Scenario`` column is inserted to preserve the
originating scenario name.

Run the script after generating the perâ€‘scenario outputs::

    python results/aggregate_techpathways.py
"""

from pathlib import Path
import pandas as pd

RESULTS_DIR = Path(__file__).parent


def _aggregate(pattern: str, prefix: str, output: str) -> None:
    files = sorted(
        p for p in RESULTS_DIR.glob(pattern) if p.name != output
    )
    if not files:
        print(f"No files found for pattern '{pattern}'.")
        return

    frames = []
    for path in files:
        scenario = path.stem.replace(prefix, "")
        df = pd.read_csv(path)
        df.insert(0, "Scenario", scenario)
        frames.append(df)

    combined = pd.concat(frames, ignore_index=True)
    combined.to_csv(RESULTS_DIR / output, index=False)
    print(f"Wrote {output} containing {len(combined)} rows across {len(frames)} scenarios.")


if __name__ == "__main__":
    _aggregate("techpathways_*.csv", "techpathways_", "techpathways_all.csv")
    _aggregate(
        "techpathways_summary_*.csv",
        "techpathways_summary_",
        "techpathways_summary_all.csv",
    )
